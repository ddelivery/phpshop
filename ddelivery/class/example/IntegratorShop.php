<?php
/**
 * Created by PhpStorm.
 * User: mrozk
 * Date: 15.05.14
 * Time: 23:14
 */

use DDelivery\Order\DDeliveryOrder;
use DDelivery\Order\DDeliveryProduct;
use DDelivery\Order\DDStatusProvider;

class IntegratorShop extends \DDelivery\Adapter\PluginFilters
{
    /**
     * –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ –∏ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–¥–µ–ª–∏–≤–µ—Ä–∏
     * @var array
     */
    protected  $cmsOrderStatus = array( DDStatusProvider::ORDER_IN_PROGRESS => 0,
                                        DDStatusProvider::ORDER_CONFIRMED => 23,
                                        DDStatusProvider::ORDER_IN_STOCK => 14,
                                        DDStatusProvider::ORDER_IN_WAY => 15,
                                        DDStatusProvider::ORDER_DELIVERED => 16,
                                        DDStatusProvider::ORDER_RECEIVED => 17,
                                        DDStatusProvider::ORDER_RETURN => 20,
                                        DDStatusProvider::ORDER_CUSTOMER_RETURNED => 21,
                                        DDStatusProvider::ORDER_PARTIAL_REFUND => 22,
                                        DDStatusProvider::ORDER_RETURNED_MI => 2,
                                        DDStatusProvider::ORDER_WAITING => 25,
                                        DDStatusProvider::ORDER_CANCEL => 26 );
    /**
     * –í–µ—Ä–Ω–∏—Ç–µ true –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π(stage) —Å–µ—Ä–≤–µ—Ä
     * @return bool
     */
    public function isTestMode(){
        return true;
        // TODO: Change the autogenerated stub
    }


    /**
     * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã –Ω–∞—Ö–æ–¥—è—â–∏–µ—Å—è –≤ –∫–æ—Ä–∑–∏–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –æ–¥–∏–Ω —Ä–∞–∑, –∑–∞—Ç–µ–º –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω
     * @return DDeliveryProduct[]
     */
    protected function _getProductsFromCart(){
        $products = array();

        $products[] = new DDeliveryProduct(
            1,	//	int $id id —Ç–æ–≤–∞—Ä–∞ –≤ —Å–∏—Å—Ç–µ–º–µ –∏-–Ω–µ—Ç –º–∞–≥–∞–∑–∏–Ω–∞
            20,	//	float $width –¥–ª–∏–Ω–Ω–∞
            13,	//	float $height –≤—ã—Å–æ—Ç–∞
            25,	//	float $length —à–∏—Ä–∏–Ω–∞
            0.5,	//	float $weight –≤–µ—Å –∫–≥
            1000,	//	float $price —Å—Ç–æ–∏–º–æ—Å—Ç—å–≤ —Ä—É–±–ª—è—Ö
            1,	//	int $quantity –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞
            '–í–µ—Å–µ–ª—ã–π –∫–ª–æ—É–Ω'	//	string $name –ù–∞–∑–≤–∞–Ω–∏–µ –≤–µ—â–∏
        );
        $products[] = new DDeliveryProduct(2, 10, 13, 15, 0.3, 1500, 2, '–ì—Ä—É—Å—Ç–Ω—ã–π –∫–ª–æ—É–Ω');
        return $products;
    }

    /**
     * –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
     * @return array
     */
    public function getDbConfig(){

        return array(
            'pdo' => new \PDO('mysql:host=localhost;dbname=ddelivery', 'root', 'root', array(\PDO::MYSQL_ATTR_INIT_COMMAND => "SET NAMES utf8")),
            'prefix' => '',
        );

        return array(
            'type' => self::DB_SQLITE,
            'dbPath' => $this->getPathByDB(),
            'prefix' => '',
        );



        return array(
            'type' => self::DB_MYSQL,
            'dsn' => 'mysql:host=localhost;dbname=ddelivery',
            'user' => 'root',
            'pass' => '0',
            'prefix' => '',
        );
    }

    /**
     * –ú–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∑–∞–∫–∞–∑–∞ cms
     *
     * @param $cmsOrderID - id –∑–∞–∫–∞–∑–∞
     * @param $status - —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
     *
     * @return bool
     */
    public function setCmsOrderStatus($cmsOrderID, $status){
        // TODO: Implement setCmsOrderStatus() method.
    }

    /**
     * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç API –∫–ª—é—á, –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –µ–≥–æ –¥–ª—è –í–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
     * @return string
     */
    public function getApiKey(){
            return '852af44bafef22e96d8277f3227f0998';
    }

    /**
     * –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å url –¥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ —Å —Å—Ç–∞—Ç–∏–∫–æ–π
     * @return string
     */
    public function getStaticPath(){
        return '../html/';
    }

    /**
     * URL –¥–æ —Å–∫—Ä–∏–ø—Ç–∞ –≥–¥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è DDelivery::render
     * @return string
     */
    public function getPhpScriptURL(){
        // –¢–æ–µ—Å—Ç—å –¥–æ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞
        return 'ajax.php';
    }

    /**
     * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Ç—å –¥–æ —Ñ–∞–π–ª–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –ø–æ–ª–æ–∂–∏—Ç–µ –µ–≥–æ –≤ –º–µ—Å—Ç–æ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø–æ –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–µ
     * @return string
     */
    public function getPathByDB(){
        return __DIR__.'/../db/db.sqlite';
    }

    /**
     * –ú–µ—Ç–æ–¥ –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫–æ–Ω—á–∏—Ç –≤—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
     *
     * @param \DDelivery\Order\DDeliveryOrder $order
     * @return void
     */
    public function onFinishChange(\DDelivery\Order\DDeliveryOrder $order){

    }

    /**
     * –ö–∞–∫–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ö—É–µ—Ç—Å—è
     * @return float
     */
    public function getDeclaredPercent(){
        return 100; // –ù—É —ç—Ç–æ –∂–µ –ø—Ä–∏–º–µ—Ä, –ø—É—Å–∫–∞–π –±—É–¥–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç
    }

    /**
     * –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Ç–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∫–æ—Ç–æ—Ä—ã–µ  –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –∫—É—Ä—å–µ—Ä–∫–µ
     *
     * @return int[]
     */
    public function filterCompanyPointCourier(){
        //return array();
        return array(23,27,29,35, 36, 40, 45, 48 );
        // TODO: Implement filterCompanyPointCourier() method.
    }

    /**
     * –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Ç–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∫–æ—Ç–æ—Ä—ã–µ  –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ —Å–∞–º–æ–≤—ã–≤–æ–∑–µ
     *
     * @return int[]
     */
    public function filterCompanyPointSelf(){
        //return array();
        return array(38,39,40);
        // TODO: Implement filterCompanyPointSelf() method.
    }

    /**
     * –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã  c –Ω–∞–ª–æ–∂–µ–Ω–Ω—ã–º –ø–ª–∞—Ç–µ–∂–µ–º –¥–ª—è –∫—É—Ä—å–µ—Ä–∞
     * @return int
     */
    public function filterPointByPaymentTypeCourier(){
        return 1;
    }

    /**
     * –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã  c –Ω–∞–ª–æ–∂–µ–Ω–Ω—ã–º –ø–ª–∞—Ç–µ–∂–µ–º –¥–ª—è —Å–∞–º–æ–≤—ã–≤–æ–∑–∞
     * @return int
     */
    public function filterPointByPaymentTypeSelf(){
        return 2;
    }

    /**
     * –ï—Å–ª–∏ true, —Ç–æ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ü–µ–Ω—É –∑–∞–±–æ—Ä–∞
     * @return bool
     */
    public function isPayPickup(){
        return false;
        return true;
        // TODO: Implement isPayPickup() method.
    }

    /**
     * –ú–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ø–ª–∞—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞ –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–±—Ä–∞–Ω—ã –∏–∑ –∞–¥–º–∏–Ω–∫–∏
     *
     * @return array
     */
    public function getIntervalsByPoint(){
        return array();
        return array(
            array('min' => 0, 'max'=>100, 'type'=>self::INTERVAL_RULES_MARKET_AMOUNT, 'amount'=>30),
            array('min' => 100, 'max'=>200, 'type'=>self::INTERVAL_RULES_CLIENT_ALL, 'amount'=>60),
            array('min' => 200, 'max'=>5000, 'type'=>self::INTERVAL_RULES_MARKET_PERCENT, 'amount'=>50),
            array('min' => 5000, 'max'=>null, 'type'=>self::INTERVAL_RULES_MARKET_ALL),
        );
    }

    /**
     * –¢–∏–ø –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
     * @return int
     */
    public function aroundPriceType(){
        return self::AROUND_ROUND; // self::AROUND_FLOOR, self::AROUND_CEIL
    }

    /**
     * –®–∞–≥ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
     * @return float
     */
    public function aroundPriceStep(){
        return 0.5; // –î–æ 50 –∫–æ–ø–µ–µ–∫
        // TODO: Implement aroundPriceStep() method.
    }

    /**
     * –æ–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–ª—É–∂–± –¥–æ—Å—Ç–∞–≤–∫–∏
     * @return string
     */
    public function getCustomPointsString(){
        return '';
    }

    /**
     * –ï—Å–ª–∏ –≤—ã –∑–Ω–∞–µ—Ç–µ –∏–º—è –ø–æ–∫—É–ø–∞—Ç–µ–ª—è, —Å–¥–µ–ª–∞–π—Ç–µ —á—Ç–æ–±—ã –æ–Ω–æ –≤–µ—Ä–Ω—É–ª–æ—Å—å –≤ —ç—Ç–æ–º –º–µ—Ç–æ–¥–µ
     * @return string|null
     */
    public function getClientFirstName() {
        return null;
    }

    /**
     * –ï—Å–ª–∏ –≤—ã –∑–Ω–∞–µ—Ç–µ —Ñ–∞–º–∏–ª–∏—é –ø–æ–∫—É–ø–∞—Ç–µ–ª—è, —Å–¥–µ–ª–∞–π—Ç–µ —á—Ç–æ–±—ã –æ–Ω–æ –≤–µ—Ä–Ω—É–ª–æ—Å—å –≤ —ç—Ç–æ–º –º–µ—Ç–æ–¥–µ
     * @return string|null
     */
    public function getClientLastName() {
        return null;
    }

    /**
     * –ï—Å–ª–∏ –≤—ã –∑–Ω–∞–µ—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ–∫—É–ø–∞—Ç–µ–ª—è, —Å–¥–µ–ª–∞–π—Ç–µ —á—Ç–æ–±—ã –æ–Ω–æ –≤–µ—Ä–Ω—É–ª–æ—Å—å –≤ —ç—Ç–æ–º –º–µ—Ç–æ–¥–µ. 11 —Å–∏–º–≤–æ–ª–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä 79211234567
     * @return string|null
     */
    public function getClientPhone() {
        return null;
    }

    /**
     * –í–µ—Ä–Ω–∏ –º–∞—Å—Å–∏–≤ –ê–¥—Ä–µ—Å, –î–æ–º, –ö–æ—Ä–ø—É—Å, –ö–≤–∞—Ä—Ç–∏—Ä–∞. –ï—Å–ª–∏ –Ω–µ –º–æ–∂–µ—à—å –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ –≤ –æ–¥–Ω–æ–º –ø–æ–ª–µ –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ get*RequiredFields
     * @return string[]
     */
    public function getClientAddress() {
        return array('1','2','3','4','5');
    }

    /**
     * –í–µ—Ä–Ω–∏—Ç–µ id –≥–æ—Ä–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º–µ DDelivery
     * @return int
     */
    public function getClientCityId(){
        // –ï—Å–ª–∏ –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≥–æ—Ä–æ–¥–µ, –æ—Å—Ç–∞–≤—å—Ç–µ –≤—ã–∑–æ–≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –º–µ—Ç–æ–¥–∞.
        return parent::getClientCityId();
    }

    /**
     * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–∞–≥–∞–∑–∏–Ω–æ–º —Å–ø–æ—Å–æ–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏
     * @return array
     */
    public function getSupportedType(){
        return array(
           \DDelivery\Sdk\DDeliverySDK::TYPE_COURIER,
            \DDelivery\Sdk\DDeliverySDK::TYPE_SELF
        );
    }

    /**
     * –ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø—É–Ω–∫—Ç—ã —Å–∞–º–æ–≤—ã–≤–æ–∑–∞ –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ
     *
     * @param DDeliveryOrder $order
     */
    /*
    public function filterPointsSelf($selfPoints, DDeliveryOrder $order){

        $selfPoints = parent::filterPointsSelf($selfPoints, $order);
        /* –ø—Ä–∏–º–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞ –Ω–∞ –∫–∞—Ä—Ç—É
        $myCourier = new \DDelivery\Point\PointSelfCustom(
            1, '–ú–æ—è –∫–æ–º–ø–∞–Ω–∏—è', '–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫–∞—è –∫—Ä–µ–ø–æ—Å—Ç—å, 8',
            59.950236, 30.31537, 100, 0, '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ —Å 10 –¥–æ 22',
            '', ''
        );
        $selfPoints[] = $myCourier;
        return $selfPoints;
    }
    */

    /**
     * –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–∫–∞–∑–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–¥–µ–ª–∏–≤–µ—Ä–∏ –∏–¥–µ—Ç
     * –ø—Ä–æ–≤–µ—Ä–∫–∞  —Å—Ç–∞—Ç—É—Å–∞  –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–æ–≥–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
     *
     * @param mixed $cmsStatus
     * @return bool|void
     */
    public function isStatusToSendOrder( $cmsStatus ){
        return;
    }
    /**
     *
     * –ü–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º —Ç–æ—á–µ–∫ —Å–∞–º–æ–≤—ã–≤–æ–∑–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏—Ö –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º
     *
     * @param $companyArray
     * @param DDeliveryOrder $order
     * @return mixed
     */
    public function finalFilterSelfCompanies( $companyArray, DDeliveryOrder $order ){
        return $companyArray;
    }
    /**
     *
     *  –ü–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º –∫–æ–º–ø–∞–Ω–∏–π –∫—É—Ä—å–µ—Ä–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏—Ö –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º
     *
     * @param $companyArray
     * @param DDeliveryOrder $order
     * @return mixed
     */
    public function finalFilterCourierCompanies( $companyArray, DDeliveryOrder $order ){
        return $companyArray;
    }
    /**
     * –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã –¥–ª—è –°–∞–º–æ–≤—ã–≤–æ–∑–∞ ( –º–æ–∂–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ order )
     * @param $order DDeliveryOrder
     * @return array
     */
    public function getSelfPaymentVariants( DDeliveryOrder $order ){
        return array(1,2);
    }

    /**
     * –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã –¥–ª—è –∫—É—Ä—å–µ—Ä–∞ ( –º–æ–∂–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ order )
     * @param $order DDeliveryOrder
     * @return array
     */
    public function getCourierPaymentVariants( DDeliveryOrder $order ){
        return array();
    }

    /**
     *
     * –?—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä DD –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
     *
     * –ï—Å–ª–∏ true —Ç–æ –∑–∞—è–≤–∫–∞ –≤ —Å–µ—Ä–≤–∏—Å–µ DDelivery –±—É–¥–µ—Ç –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤ —Å—Ç–∞—Ç—É—Å "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞",
     * –µ—Å–ª–∏ false —Ç–æ —Ç–æ –∑–∞—è–≤–∫–∞ –≤ —Å–µ—Ä–≤–∏—Å–µ DDelivery –±—É–¥–µ—Ç –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤ —Å—Ç–∞—Ç—É—Å "–í –æ–±—Ä–∞–±–æ—Ç–∫–µ"
     *
     * @param mixed $localStatus
     *
     * @return bool
     */
    public function isConfirmedStatus( $localStatus ){
        return true;
    }
}