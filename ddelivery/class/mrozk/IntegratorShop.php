<?php
/**
 * Created by PhpStorm.
 * User: mrozk
 * Date: 4/28/14
 * Time: 11:47 AM
 */

use DDelivery\Order\DDeliveryProduct;
use DDelivery\Adapter\PluginFilters;
use DDelivery\Order\DDStatusProvider;
//ini_set("display_errors", "1");
//error_reporting(E_ALL);

class IntegratorShop extends PluginFilters {

    public $cmsSettings;

    public $fields;

    protected  $cmsOrderStatus = array( DDStatusProvider::ORDER_IN_PROGRESS => 0,
                                        DDStatusProvider::ORDER_CONFIRMED => 2,
                                        DDStatusProvider::ORDER_IN_STOCK => 14,
                                        DDStatusProvider::ORDER_IN_WAY => 15,
                                        DDStatusProvider::ORDER_DELIVERED => 16,
                                        DDStatusProvider::ORDER_RECEIVED => 17,
                                        DDStatusProvider::ORDER_RETURN => 20,
                                        DDStatusProvider::ORDER_CUSTOMER_RETURNED => 21,
                                        DDStatusProvider::ORDER_PARTIAL_REFUND => 22,
                                        DDStatusProvider::ORDER_RETURNED_MI => 2,
                                        DDStatusProvider::ORDER_WAITING => 25,
                                        DDStatusProvider::ORDER_CANCEL => 26 );

    public function __construct( $fields = array() )
    {
        $this->fields = $fields;
        $query = 'SELECT * FROM ddelivery_module_system WHERE id = 1';
        $cur = mysql_query($query);
        $this->cmsSettings = mysql_fetch_assoc($cur);


    }


    /**
     * –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
     * @return array
     */
    public function getDbConfig()
    {
        $user_db = $GLOBALS['SysValue']['connect']['user_db'];
        $pass_db = $GLOBALS['SysValue']['connect']['pass_db'];
        $dbase = $GLOBALS['SysValue']['connect']['dbase'];
        $host = $GLOBALS['SysValue']['connect']['host'];

        return array(
            'pdo' => new \PDO('mysql:host=' . $host . ';dbname=' . $dbase , $user_db, $pass_db, array(\PDO::MYSQL_ATTR_INIT_COMMAND => "SET NAMES cp1251")),
            'prefix' => 'ddelivery_module_',
        );

        return array(
            'type' => self::DB_SQLITE,
            'dbPath' => $this->getPathByDB(),
            'prefix' => '',
        );

        return array(
            'type' => self::DB_MYSQL,
            'dsn' => 'mysql:host=localhost;dbname=ddelivery',
            'user' => 'root',
            'pass' => '0',
            'prefix' => '',
        );
    }

    public function isStatusToSendOrder( $status )
    {
        if( $this->cmsSettings['status'] == $status )
        {
            return true;
        }
        return false;
    }
    /**
     * –í–µ—Ä–Ω–∏—Ç–µ true –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π(stage) —Å–µ—Ä–≤–µ—Ä
     * @return bool
     */
    public function isTestMode()
    {
        if ( $this->cmsSettings['rezhim']  == '0')
        {
            return true;
        }
        elseif($this->cmsSettings['rezhim']  == '1')
        {
            return false;
        }
        // TODO: Change the autogenerated stub
    }

    /**
     * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã –Ω–∞—Ö–æ–¥—è—â–∏–µ—Å—è –≤ –∫–æ—Ä–∑–∏–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –æ–¥–∏–Ω —Ä–∞–∑, –∑–∞—Ç–µ–º –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω
     * @return DDeliveryProduct[]
     */
    protected function _getProductsFromCart()
    {

        $products = array();
        // –ö–æ—Ä–∑–∏–Ω–∞
        $PHPShopCart = new PHPShopCart();
        $productsCart = $PHPShopCart->getArray();


        if( count( $productsCart ) )
        {
            foreach($productsCart as $item)
            {

                $PHPShopProduct = new PHPShopProduct($item[id]);


                $cartWidth = $PHPShopProduct->getParam("option1");
                $cartLenght = $PHPShopProduct->getParam("option2");
                $cartHeight = $PHPShopProduct->getParam("option3");
                /*
                $vendor_array =  unserialize( $PHPShopProduct->objRow['vendor_array'] ) ;
                //$params = $this->cmsSettings['width'];
                if( is_array( $vendor_array ) )
                {
                    if( array_key_exists($this->cmsSettings['width'], $vendor_array) )
                    {
                        $param = (int)$vendor_array[$this->cmsSettings['width']][0];
                        $cur = mysql_query('SELECT name FROM phpshop_sort WHERE id = ' . $param);
                        $cartWidth = (int)mysql_fetch_array($cur)[0];
                        //print_r($cartWidth);
                    }

                    if( array_key_exists($this->cmsSettings['length'], $vendor_array) )
                    {
                        $param = (int)$vendor_array[$this->cmsSettings['length']][0];
                        $cur = mysql_query('SELECT name FROM phpshop_sort WHERE id = ' . $param);
                        $cartLenght = (int)mysql_fetch_array($cur)[0];
                    }

                    if( array_key_exists($this->cmsSettings['height'], $vendor_array) )
                    {
                        $param = (int)$vendor_array[$this->cmsSettings['height']][0];
                        $cur = mysql_query('SELECT name FROM phpshop_sort WHERE id = ' . $param);
                        $cartHeight = (int)mysql_fetch_array($cur)[0];
                    }
                }
               // mysql_query('SELECT name FROM phpshop_sort WHERE id IN()');
                */

                $cartWeight = $item['weight'] / 1000;


                $width = (empty($cartWidth)?$this->cmsSettings['def_width']:$cartWidth);
                $lenght = (empty($cartLenght)?$this->cmsSettings['def_lenght']:$cartLenght);
                $height = (empty($cartHeight)?$this->cmsSettings['def_height']:$cartHeight);
                $weight = (empty($cartWeight)?$this->cmsSettings['def_weight']:$cartWeight);

                $products[] = new \DDelivery\Order\DDeliveryProduct( $item['id'],
                    $width, $height, $lenght, $weight,
                    $item['price'], $item['num'], iconv('windows-1251', 'UTF-8',$item['name']));


            }
        }

        return $products;
    }

    /**
     * –ú–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∑–∞–∫–∞–∑–∞ cms
     *
     * @param $cmsOrderID - id –∑–∞–∫–∞–∑–∞
     * @param $status - —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
     *
     * @return bool
     */
    public function setCmsOrderStatus($cmsOrderID, $status)
    {
        $orders = $GLOBALS['SysValue']['base']['orders'];
        $query = 'UPDATE ' . $orders . ' SET statusi = ' . $status . ' WHERE id = ' . $cmsOrderID;
        $cur = mysql_query($query);
        $this->cmsSettings = mysql_fetch_assoc($cur);
    }

    public function getOrderIDsByStatus()
    {
        $orders = $GLOBALS['SysValue']['base']['orders'];

        $query = 'SELECT uid FROM ' . $orders . ' WHERE statusi =' . $this->cmsSettings['status'];
        $cur = mysql_query($query);
        $result = array();
        while ($k = mysql_fetch_array($cur))
        {
            $result[] = $k[0];
        }

        return $result;
    }

    /**
     * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç API –∫–ª—é—á, –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –µ–≥–æ –¥–ª—è –í–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
     * @return string
     */
    public function getApiKey()
    {
        return $this->cmsSettings['api'];
    }

    /**
     * –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å url –¥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ —Å —Å—Ç–∞—Ç–∏–∫–æ–π
     * @return string
     */
    public function getStaticPath()
    {
        return '../html/';
    }

    /**
     * URL –¥–æ —Å–∫—Ä–∏–ø—Ç–∞ –≥–¥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è DDelivery::render
     * @return string
     */
    public function getPhpScriptURL()
    {
        // –¢–æ–µ—Å—Ç—å –¥–æ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞
        return 'ajax.php';
    }

    /**
     * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Ç—å –¥–æ —Ñ–∞–π–ª–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –ø–æ–ª–æ–∂–∏—Ç–µ –µ–≥–æ –≤ –º–µ—Å—Ç–æ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø–æ –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–µ
     * @return string
     */
    public function getPathByDB()
    {
        return __DIR__.'/../db/db.sqlite';
    }

    /**
     * –ú–µ—Ç–æ–¥ –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫–æ–Ω—á–∏—Ç –≤—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
     *
     * @param int $orderId
     * @param \DDelivery\Order\DDeliveryOrder $order
     * @param bool $customPoint –ï—Å–ª–∏ true, —Ç–æ –∑–∞–∫–∞–∑ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –º–∞–≥–∞–∑–∏–Ω–æ–º
     * @return void
     */
    public function onFinishChange($orderId, \DDelivery\Order\DDeliveryOrder $order, $customPoint)
    {
        if($customPoint){
            // –≠—Ç–æ —É—Å–ª–æ–≤–∏–µ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º —á—Ç–æ –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–∫–∞–∑ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ CMS
        }else{
            // –ó–∞–ø–æ–º–Ω–∏ id –∑–∞–∫–∞–∑–∞
        }

    }

    /**
     * –ö–∞–∫–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ö—É–µ—Ç—Å—è
     * @return float
     */
    public function getDeclaredPercent()
    {
        return $this->cmsSettings['declared'];
    }

    /**
     * –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Ç–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∫–æ—Ç–æ—Ä—ã–µ –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –∫—É—Ä—å–µ—Ä–∫–µ
     * —Å–º. —Å–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π –≤ DDeliveryUI::getCompanySubInfo()
     * @return int[]
     */
    public function filterCompanyPointCourier()
    {
        $cur_companies = unserialize( $this->cmsSettings['cur_companies'] );
        if( empty( $cur_companies ) )
        {
            $res = array();
        }
        else
        {
            $res = array_values($cur_companies) ;

        }
        return $res;
        // TODO: Implement filterCompanyPointCourier() method.
    }

    /**
     * –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Ç–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∫–æ—Ç–æ—Ä—ã–µ –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ —Å–∞–º–æ–≤—ã–≤–æ–∑–µ
     * —Å–º. —Å–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π –≤ DDeliveryUI::getCompanySubInfo()
     * @return int[]
     */
    public function filterCompanyPointSelf()
    {
        $cur_companies = unserialize( $this->cmsSettings['pvz_companies'] );
        if( empty( $cur_companies ) )
        {
            $res = array();
        }
        else
        {
            $res = array_values($cur_companies) ;

        }
        return $res;
        // TODO: Implement filterCompanyPointSelf() method.
    }

    /**
     * –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç–æ–π PluginFilters::PAYMENT_, –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –∏–ª–∏ –æ–ø–ª–∞—Ç–∞ –Ω–∞ –º–µ—Å—Ç–µ. –ö—É—Ä—å–µ—Ä
     * @return int
     */
    public function filterPointByPaymentTypeCourier()
    {
        return $this->cmsSettings['payment'];
        /*
        return self::PAYMENT_POST_PAYMENT;
        // –≤—ã–±–∏—Ä–∞–µ–º –æ–¥–∏–Ω –∏–∑ 3 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤(—Å–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∏–ª–∏ –∫–æ–º–º–µ–Ω—Ç—ã –∫ –∫–æ–Ω—Å—Ç–∞—Ç–∞–º)
        return self::PAYMENT_POST_PAYMENT;
        return self::PAYMENT_PREPAYMENT;
        return self::PAYMENT_NOT_CARE;
        */
        // TODO: Implement filterPointByPaymentTypeCourier() method.
    }

    /**
     * –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç–æ–π PluginFilters::PAYMENT_, –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –∏–ª–∏ –æ–ø–ª–∞—Ç–∞ –Ω–∞ –º–µ—Å—Ç–µ. –°–∞–º–æ–≤—ã–≤–æ–∑
     * @return int
     */
    public function filterPointByPaymentTypeSelf()
    {
        return $this->cmsSettings['payment'];
        //return self::PAYMENT_POST_PAYMENT;
        // –≤—ã–±–∏—Ä–∞–µ–º –æ–¥–∏–Ω –∏–∑ 3 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤(—Å–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∏–ª–∏ –∫–æ–º–º–µ–Ω—Ç—ã –∫ –∫–æ–Ω—Å—Ç–∞—Ç–∞–º)
        /*
        return self::PAYMENT_POST_PAYMENT;
        return self::PAYMENT_PREPAYMENT;
        return self::PAYMENT_NOT_CARE;
        // TODO: Implement filterPointByPaymentTypeSelf() method.
        */
    }
    public function getClientLastName() {
        if( isset( $_SESSION['dd_name_person'])  ){
            $data = explode(' ', trim($_SESSION['dd_name_person']));
            if(isset($data[0])){
                return $data[0];
            }
        }
        return '';
    }
    /**
     * –ï—Å–ª–∏ true, —Ç–æ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ü–µ–Ω—É –∑–∞–±–æ—Ä–∞
     * @return bool
     */
    public function isPayPickup()
    {
        $zabor = (int)$this->cmsSettings['zabor'];
        if( $zabor ) return true;
        else         return false;
        // TODO: Implement isPayPickup() method.
    }

    /**
     * –ú–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ø–ª–∞—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞ –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–±—Ä–∞–Ω—ã –∏–∑ –∞–¥–º–∏–Ω–∫–∏
     *
     * @return array
     */
    public function getIntervalsByPoint()
    {
        $result = array();
        if( !empty( $this->cmsSettings['from1'] ) &&  !empty( $this->cmsSettings['to1'] ) && !empty( $this->cmsSettings['method1'] ) &&
            !empty( $this->cmsSettings['methodval1'] ) )
        {
            $result[] = array('min' => $this->cmsSettings['from1'], 'max'=>$this->cmsSettings['to1'],
                              'type'=>$this->cmsSettings['method1'], 'amount'=>$this->cmsSettings['methodval1']);
        }
        if( !empty( $this->cmsSettings['from2'] ) &&  !empty( $this->cmsSettings['to2'] ) && !empty( $this->cmsSettings['method2'] ) &&
            !empty( $this->cmsSettings['methodval2'] )  )
        {
            $result[] = array('min' => $this->cmsSettings['from2'], 'max'=>$this->cmsSettings['to2'],
                              'type'=>$this->cmsSettings['method2'], 'amount'=>$this->cmsSettings['methodval2']);
        }
        if( !empty( $this->cmsSettings['from3'] ) &&  !empty( $this->cmsSettings['to3'] ) && !empty( $this->cmsSettings['method3'] ) &&
            !empty( $this->cmsSettings['methodval3'] ) )
        {
            $result[] = array('min' => $this->cmsSettings['from3'], 'max'=>$this->cmsSettings['to3'],
                              'type'=>$this->cmsSettings['method3'], 'amount'=>$this->cmsSettings['methodval3']);
        }
        return $result;
        /*
        return array(
            array('min' => 0, 'max'=>100, 'type'=>self::INTERVAL_RULES_MARKET_AMOUNT, 'amount'=>30),
            array('min' => 100, 'max'=>200, 'type'=>self::INTERVAL_RULES_CLIENT_ALL, 'amount'=>60),
            array('min' => 300, 'max'=>400, 'type'=>self::INTERVAL_RULES_MARKET_PERCENT, 'amount'=>3),
            array('min' => 1000, 'max'=>null, 'type'=>self::INTERVAL_RULES_MARKET_ALL),
        );
        */
    }

    /**
     * –¢–∏–ø –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
     * @return int
     */
    public function aroundPriceType()
    {
        switch ($this->cmsSettings['okrugl'])
        {
            case '0': return self::AROUND_FLOOR;
            case '1': return self::AROUND_CEIL;
            case '2': return self::AROUND_ROUND;
            default : return self::AROUND_ROUND;
        }
        //return self::AROUND_ROUND; // self::AROUND_FLOOR, self::AROUND_CEIL
    }

    /**
     * –®–∞–≥ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
     * @return float
     */
    public function aroundPriceStep()
    {
        $this->cmsSettings['shag'];
        return $this->cmsSettings['shag']; // –î–æ 50 –∫–æ–ø–µ–µ–∫
        // TODO: Implement aroundPriceStep() method.
    }

    /**
     * –æ–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–ª—É–∂–± –¥–æ—Å—Ç–∞–≤–∫–∏
     * @return string
     */
    public function getCustomPointsString()
    {
        return $this->cmsSettings['custom_point'];
    }

    /**
     * –ï—Å–ª–∏ –≤—ã –∑–Ω–∞–µ—Ç–µ –∏–º—è –ø–æ–∫—É–ø–∞—Ç–µ–ª—è, —Å–¥–µ–ª–∞–π—Ç–µ —á—Ç–æ–±—ã –æ–Ω–æ –≤–µ—Ä–Ω—É–ª–æ—Å—å –≤ —ç—Ç–æ–º –º–µ—Ç–æ–¥–µ
     * @return string|null
     */
    public function getClientFirstName() {
        if( isset( $_SESSION['dd_name_person'])  ){
            $data = explode(' ', trim($_SESSION['dd_name_person']));
            if(isset($data[1])){
                return $data[1];
            }
        }
        return '';
    }



    /**
     * –ï—Å–ª–∏ –≤—ã –∑–Ω–∞–µ—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ–∫—É–ø–∞—Ç–µ–ª—è, —Å–¥–µ–ª–∞–π—Ç–µ —á—Ç–æ–±—ã –æ–Ω–æ –≤–µ—Ä–Ω—É–ª–æ—Å—å
     * –≤ —ç—Ç–æ–º –º–µ—Ç–æ–¥–µ. 10 —Å–∏–º–≤–æ–ª–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä 9211234567
     *
     *@return string|null
     */
    public function getClientPhone() {
        if( isset( $_SESSION['dd_tel_name'])  ){
            $tel_name = $this->formatPhone( $_SESSION['dd_tel_name'] );
            $tel_name  = substr( $tel_name, -10);
            return '+7' . $tel_name;
        }
        return '';
    }
    /**
     * ¬˚ÂÁ‡ÂÏ ËÁ ÌÓÏÂ‡ ÚÂÎÂÙÓÌ‡ ÌÂÌÛÊÌ˚Â ÒËÏ‚ÓÎ˚
     *
     * @param string $phone
     *
     * @return string
     */
    public function formatPhone( $phone )
    {
        return preg_replace( array('/-/', '/\(/', '/\)/', '/\+7/', '/\s\s+/'), '', $phone );
    }
    /**
     * –í–µ—Ä–Ω–∏ –º–∞—Å—Å–∏–≤ –ê–¥—Ä–µ—Å, –î–æ–º, –ö–æ—Ä–ø—É—Å, –ö–≤–∞—Ä—Ç–∏—Ä–∞. –ï—Å–ª–∏ –Ω–µ –º–æ–∂–µ—à—å –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ –≤ –æ–¥–Ω–æ–º –ø–æ–ª–µ –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ get*RequiredFields
     * @return string[]
     */
    public function getClientAddress() {
        return array(/*'–ê–¥—Ä–µ—Åx','–î–æ–ºx', '–ö–æ—Ä–ø—É—Åx','–ö–≤–∞—Ä—Ç–∏—Ä–∞x'*/);
    }

    /**
     * –í–µ—Ä–Ω–∏—Ç–µ id –≥–æ—Ä–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º–µ DDelivery
     * @return int
     */
    public function getClientCityId()
    {
        // –ï—Å–ª–∏ –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≥–æ—Ä–æ–¥–µ, –æ—Å—Ç–∞–≤—å—Ç–µ –≤—ã–∑–æ–≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –º–µ—Ç–æ–¥–∞.
        return parent::getClientCityId();
    }

    /**
     * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–∞–≥–∞–∑–∏–Ω–æ–º —Å–ø–æ—Å–æ–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏
     * @return array
     */
    public function getSupportedType()
    {
        if( $this->cmsSettings['type'] == '0' )
        {
            return array(
                \DDelivery\Sdk\DDeliverySDK::TYPE_COURIER,
                \DDelivery\Sdk\DDeliverySDK::TYPE_SELF
            );
        }
        elseif($this->cmsSettings['type'] == '1')
        {
            return array(
                \DDelivery\Sdk\DDeliverySDK::TYPE_SELF
            );
        }
        elseif($this->cmsSettings['type'] == '2')
        {
            return array(
                \DDelivery\Sdk\DDeliverySDK::TYPE_COURIER,
            );
        }
    }

    /**
     * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–∏–Ω–∞—Ä–Ω—É—é –º–∞—Å–∫—É –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –¥–ª—è –∫—É—Ä—å–µ—Ä–∞
     * –ï—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –≤–∫–ª—é—á–µ–Ω–æ, –Ω–æ –µ—Å—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–æ –ø–æ–ª–µ –ø–æ—è–≤–∏—Ç—Å—è
     * –ï—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö –ø–æ–ª–µ–π –Ω–µ –±—É–¥–µ—Ç —Ç–æ –ø—Ä–æ–ø—É—Å—Ç–∏–º —à–∞–≥
     * @return int
     */
    public function getCourierRequiredFields()
    {
        // –í–í–µ—Å—Ç–∏ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –∫—Ä–æ–º–µ –∫–æ—Ä–ø—É—Å–∞
        return self::FIELD_EDIT_FIRST_NAME | self::FIELD_REQUIRED_FIRST_NAME | self::FIELD_EDIT_LAST_NAME | self::FIELD_REQUIRED_SECOND_NAME
        | self::FIELD_EDIT_PHONE | self::FIELD_REQUIRED_PHONE
        | self::FIELD_EDIT_ADDRESS | self::FIELD_REQUIRED_ADDRESS
        | self::FIELD_EDIT_ADDRESS_HOUSE | self::FIELD_REQUIRED_ADDRESS_HOUSE
        | self::FIELD_EDIT_ADDRESS_HOUSING
        | self::FIELD_EDIT_ADDRESS_FLAT;
    }

    /**
     * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–∏–Ω–∞—Ä–Ω—É—é –º–∞—Å–∫—É –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –¥–ª—è –ø—É–Ω–∫—Ç–æ–≤ —Å–∞–º–æ–≤—ã–≤–æ–∑–∞
     * –ï—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –≤–∫–ª—é—á–µ–Ω–æ, –Ω–æ –µ—Å—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–æ –ø–æ–ª–µ –ø–æ—è–≤–∏—Ç—Å—è
     * –ï—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö –ø–æ–ª–µ–π –Ω–µ –±—É–¥–µ—Ç —Ç–æ –ø—Ä–æ–ø—É—Å—Ç–∏–º —à–∞–≥
     * @return int
     */
    public function getSelfRequiredFields()
    {
        // –?–º—è, —Ñ–∞–º–∏–ª–∏—è, –º–æ–±–∏–ª–∫–∞
        return self::FIELD_EDIT_FIRST_NAME | self::FIELD_REQUIRED_FIRST_NAME
        | self::FIELD_EDIT_LAST_NAME | self::FIELD_REQUIRED_SECOND_NAME
        | self::FIELD_EDIT_PHONE | self::FIELD_REQUIRED_PHONE;
    }
} 
